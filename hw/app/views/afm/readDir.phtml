<?php

    $post =  json_decode(file_get_contents('php://input'), true);

//    $dir = BASE_PATH . "/public/" . $post["dirname"] . "/";
    $dir = BASE_PATH . "/../afm/" . $post["dirname"] . "/";
    $fileinfo = [];
    $files = [];

    // Открыть известный каталог и начать считывать его содержимое
    if (is_dir($dir)) {
        //использовать scandir для сортировки
//        if ($dh = opendir($dir)) {
        if ($dh = scandir($dir, 0)) {
//            while (($file = readdir($dh)) !== false) {
            $count = count($dh);
            for ($i = 0; $i < $count; $i++) {
                $file = $dh[$i];

                $fileinfo['id'] = $i;
                $fileinfo['name'] = $file;

//                $size = ($type === 'file') ? filesize($dir . $file) : "0";
                $fileinfo['size'] = filesize($dir . $file);;

                $type = filetype($dir . $file);

                if ($type === 'dir') {
                    $dir2 = $dir . $file . '/';
                    if (is_dir($dir2)) {
                        if ($dh2 = scandir($dir2, 0)) {
                            $fileinfo['size'] =  count($dh2) - 2;
                        }
                    }
                } else { // if ($type === 'file') {
                    $type = pathinfo( $file, PATHINFO_EXTENSION );
                }

                $fileinfo['type'] =  $type;
                $fileinfo['checked'] = false;

                $files[$i] = $fileinfo;
            }
            closedir($dh);
        }
    }

echo json_encode($files);